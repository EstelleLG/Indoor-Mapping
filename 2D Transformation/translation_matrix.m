clc
clear

%First floor scan coordinates in original spots found in duc3.obj file
ff1XYs = [2.38688325716121 -2.40609820638272; %-4.7197933427495 %scan1
          5.43858469074785 0.996520428498516; %-4.69805012309258
          8.04984567848891 1.67134243933216; %-4.65944662490398
          -3.08523174325973 10.4026462187613; %-4.70681932412253
          -9.76386557261988 28.0526752705487; %-4.47187848266167
          -21.6402696604477 23.7786391938421; %-4.3853218520663
          -24.6508512575052 31.5104594316046; %-4.17146814381101
          -26.9059100061733 38.1082995316654; %-3.94243685063116
          -29.7283244723258 45.8976293302749; %-3.60696508401552
          -21.4137239143579 48.6484877822204; %-3.68844265495139 %scan10
          -0.197044504253541 18.8316652278761; %-4.60401874498462
          4.73385226826068 20.2671726069638; %-4.55252134283491
          -3.25164350090992 26.7900783099577; %-4.49296437999233
          1.22821074635387 31.9387045146714; %-4.38534703459547
          -2.37059333549959 42.426527704035; %-4.12532764598228
          -6.14913193352538 39.2893054911532; %-4.20504723175437
          -13.5525589074939 35.1092235423288; %-4.27653700799692
          -16.0880295968485 42.0504843948531; %-4.03945286804537
          -11.0109219447006 44.697256270653; %-4.00152227843699
          -14.8085110142069 50.0836296898106; %-3.74692435225081 %scan20
          -6.24411072433622 53.5124200285843; %-3.68911945992013
          -5.52283803322127 -1.21179634173664; %-4.78560182743053
          -9.83082595980642 -4.41444329071224; %-4.72815152404895
          -8.87680692839186 -6.28264858706664; %-4.71326264025381
          -3.0203266272603 -6.82969615115132; %-4.73157620534706
          
          1.12198887192469 -6.10614325458991; %-4.71437182587063 %scan26 all scans are good up to this point
%           2.79756799150456 8.91531384610836; %-2.23861943555291
%           -20.1295049946375 20.8619393628404; %-2.00336371945347
%           -14.3846724374887 22.2265904484465; %-4.40664330016281
%           -12.1389451758379 24.8456194485013; %-4.37160442212589
%           -16.834790417098 18.22626865506; %-4.39576734351849
%           -17.6488981001633 28.7277583418632; %-4.21359875736723
%           -24.3831855200639 27.1318982663571; %-4.12337978888431
%           -11.3804247209133 14.231671528992; %-4.51148898860017
%           -15.0855284954967 13.8155233467377; %-4.46465406055844
%           -13.4022734605077 28.8319762025389; %-4.2587430647022
%           -13.3953005993322 28.8336556952741; %-4.26498958824353
%           -14.3900301108892 11.7959581481342; %-4.46760419837045
%           -10.225579194131 6.61609284538266; %-4.55041372399668
%           -7.87226350705775 6.94375592441349; %-4.57214835890759
%           -11.2049977758289 10.3279669691985; %-4.51223610600448
%           -10.4447354543114 2.23959747229895; %-4.53473990410238
%           -10.6727148633331 -0.0759442683573077; %-4.51244782318447
%           -13.8335660080464 1.25923659159038; %-4.45845225831915
%           -6.46947088007359 1.89437160816528; %-4.57426083434746
%           -6.44873547480494 -1.94188872535752; %-4.52333213216688
%          -9.58100851715148 -3.42235924673511; %-4.45453460768937
          -1.00370039364732 55.4570914633088; %-3.61291942021738 %scan87 all scans after and including 87 are good.
          3.46609585640282 56.8107935430838; %-3.50936969331231
          1.9152548595109 60.4164140898035; %-3.35050835185476
          -2.02615640934546 58.5698444853922; %-3.44918009916877
          1.18053564308796 52.2861201181164]; %-3.73945267345857

%Second floor scan coordinates in original spots found in duc3.obj file
sf1XYs = [1.10769209830536 31.3190192109824; %0.316254126224811 %scan28
          10.1158913747991 34.2840453969293; %0.397955968872877
          9.90602063559972 40.8508810058659; %0.540003405956614
          5.42016419227091 35.9560778296524; %0.405958439280843
          17.8469960561523 41.3246328874186; %0.635929511586276
          3.38882752598883 24.0318864138395; %0.177772953752684
          6.13899965701772 15.2317352331223; %0.06543855778779
          10.3538460558246 3.50965495061448; %0.0306247841299858
          -3.28295505127407 9.64105361895086; %0.00828226471017957
          -6.3515796181298 18.3858094065983; %0.0911805737677088 %scan38
%           -9.67443960010307 27.9398598244781; %0.252420780673967
%           -15.7841942050622 25.7273201447464; %0.262695387789588
%           -17.1382711735758 28.8368839196549; %0.320841441749527
%           -22.9698613130592 28.5422858269349; %0.414135572287964
%           -23.7276045883263 32.7399493978626; %0.528614694021535
%           -18.7833700093161 34.0708510825697; %0.479046652555704
%           -15.5527781959789 35.472608592909; %0.477031707163571
%           -14.1033517327899 29.9367606490909; %0.402438362792367
%           -18.9518610450482 25.2505211679153; %0.288592595189091
%           -14.8342832828103 23.281195572661; %0.254370979129315
%           -18.3924556479418 16.8340241514299; %0.186472643983953
%           -13.9922545905521 20.6941699748796; %0.169381617374493
%           -12.3940760640844 15.5285444613359; %0.100059063653238
%           -9.85234383243105 16.6394203286685; %0.127268668649242
%           -8.8704378789726 14.0365107387098; %0.0670050179146685
%           -12.104786244688 12.8221701575664; %0.0601733786824925
%           -15.8697332658315 13.1413599100144; %0.123051195492468
%           -10.5061162717917 8.60002201837134; %0.0835179085456021
%           -6.93715308589394 8.28085387928703; %0.126496011736345
%           -9.92139188009147 7.14490284323617; %0.0992728608330672
%           -14.0905554087557 4.23308158023877; %0.126197892557082
%           -8.19717558886757 1.29412688783358; %0.164572536171476
%           -5.54477746260919 3.76672050937106; %0.167183253919162
%           -11.4070108488234 -0.527694980208361; %0.195180117690279
%           -6.46098239504747 -1.18938443969499; %0.232806952554893
%           -4.20525606933644 -3.89646056581405; %0.30601945944615
%           -9.36364745344165 -5.98913247665775; %0.344625629783
%           -10.8611675282317 31.4498029895435; %0.356562752190184
%           -12.690263536237 37.6550987963658; %0.571920062222995
%           -2.17103160344637 41.4458957244314; %0.62529794631394
%           0.236673745338956 34.6443743778021; %0.379465970153271
%           0 2.22044604925031e-016; %8.88178419700125e-016
%           4.36823560589159 -2.86151215162799; %0.0098620831677998
%           7.10583680575223 -9.64241656450929; %0.0904693198721489
%           8.88614424089467 -15.9501977470347; %0.215407537333904
%           12.6265240712697 -14.8804978575265; %0.246669483625766
%           10.5219065658881 -17.9924878527529; %0.287093727205304
%           2.04648587839412 -8.78120987754562; %0.0406395425351285
%           3.09786653914548 -11.8643199682871; %0.106259623116882
%           4.98426673731434 -17.5646111372642; %0.216688719305142
%           6.67783155886424 -22.5542039826556; %0.383064440307188
%           0.376845067225938 -14.9855528810633; %0.160048009831123
%           -7.69878109223616 -15.0709130484805; %0.249925145907753
%           1.31273733007962 -24.3579408682546; %0.449346411044889
%           2.17087603781949 -27.5242081371784; %0.597684668175977
%           12.218615808684 -20.8099669887349; %0.380979442863515
%           18.3741798665883 -18.8343816102714; %0.436040161085178
%           21.1708201998659 -18.1213315346535; %0.477697837656058
%           16.5231386018111 -12.7534353824596; %0.281341046134476
%           19.0115999275486 -11.9220507494666; %0.323674958128443
%           18.0604707020743 -7.59720177719769; %0.287382849107667
%           24.2954710426316 -1.44196546084667; %0.504116262141515
%           28.8034488864855 0.0835615456078458; %0.687492662055996
%           31.2591967709242 -8.00739878635473; %0.662208284526619
%           33.5926427435201 -15.1581104259952; %0.736342573097269
%           28.0199050580891 -17.5357572934711; %0.497314350496691
%           38.0899867492686 -5.6788366349834; %1.03663816957933
%           39.1405109781832 -8.24572096384066 %1.06113955678181
%           43.784844925198 -6.87828729185086 %1.39273742377333
%           27.1292076616261 4.96982130823886; %0.700167056485036
%           33.7233850741135 7.23636404300048; %1.08332458947062
%           26.3949764461552 8.26950321367308; %0.759806675619681
%           24.0242822535457 4.86385812793224; %0.571597607309793
%           30.9019803158759 10.5368532287167; %1.04428712453644
%           19.5149597626026 6.7579119198031; %0.489129510077063
%           20.8698475391482 2.16816007890913; %0.419345163421558
%           12.7509975319849 -1.43904364969322
          ]; %.0855042587345949 %scan132

          %Not sure which floor the coordinates belong to.
          %-0.315208544700813 -0.0134940053466863 -0.000786375320477123
          %-23.8138734727734 -5.83769881897844 -10.4497991650848
          %5.14237985870194 1.94763343385272 -0.0117637264166452 %scan27


%First floor ten coordinates used for testing/debugging program
fXYs = [2.38688325716121 -2.40609820638272;
       5.43858469074785 0.996520428498516;
       8.04984567848891 1.67134243933216;
       -3.08523174325973 10.4026462187613;
       -9.76386557261988 28.0526752705487;
       -21.640269660447 23.7786391938421;
       -24.6508512575052 31.5104594316046;
       -26.9059100061733 38.1082995316654;
       -29.728324472325 45.8976293302749;
       -21.4137239143579 48.64848778222049];
%Second floor ten coordinates used for testing/debugging program
sXYs = [1.10769209830536 31.3190192109824;%scan28
        10.1158913747991 34.2840453969293;
        9.90602063559972 40.8508810058659;
        5.42016419227091 35.9560778296524;
        17.8469960561523 41.3246328874186;
        3.38882752598883 24.0318864138395;
        6.13899965701772 15.2317352331223;
        10.3538460558246 3.50965495061448;
        -0.315208544700813 -0.0134940053466863;
        -3.28295505127407 9.64105361895086];%scan37
   
   
   
   
%First floor A variable matrix in equation Ax=b. Part of building the transformation
%matrix x needed to create new A.
A1 = [];
for i = 1:size(fXYs, 1)
    A1 = [A1; fXYs(i,1), fXYs(i,2), 1, 0, 0, 0; 0 0 0 fXYs(i,1),fXYs(i,2), 1];
end
disp(A1)
%Second floor A variable matrix in equation Ax=b. Part of building the transformation
%matrix x needed to create new A.
A2 = [];
for i = 1:size(sXYs, 1)
    A2 = [A2; sXYs(i,1), sXYs(i,2), 1, 0, 0, 0; 0 0 0 sXYs(i,1),sXYs(i,2), 1];
end
disp(A2)




%First floor 1-10 consecutive coordinate points created from Irfan viewer. xy order (X'Y')
fXYs = [150 458;
        171 511;
        171 566;
        382 457;
        584 453;
        571 344;
        676 342;
        779 344;
        887 345;
        897 410];
%Second floor 28-37 consecutive coordinate points created from Irfan viewer. xy order (X'Y')
sXYs = [182 495;
        177 436;
        162 350;
        81 334;
        128 412;
        96 270;
        294 438;
        409 438;
        575 435;
        590 545];

    
    
%First floor for loop that creates b to help find the transformation matrix x.
b1 = [];
for i = 1:size(fXYs, 1)
     b1 = [b1; fXYs(i,1); fXYs(i,2)];
end
disp(b1)
x1 = A1\b1;
disp(x1)
%Second floor for loop that creates b to help find the transformation matrix x.
b2 = [];
for i = 1:size(sXYs, 1)
     b2 = [b2; sXYs(i,1); sXYs(i,2)];
end
disp(b2)
x2 = A1\b2;
disp(x2)


%Changing variable names (first floor) to make next linear equation solving step easier.
a1 = x1(1);
b1 = x1(2);
c1 = x1(3);
d1 = x1(4);
e1 = x1(5);
f1 = x1(6);
%Changing variable names (second floor) to make next linear equation solving step easier.
a2 = x2(1);
b2 = x2(2);
c2 = x2(3);
d2 = x2(4);
e2 = x2(5);
f2= x2(6);


%New matrix for first floor found by using ax+by+c and dx+ey+f (multiplying A to transformation matrix).
nfXY = [];
for i=1:size(ff1XYs,1)
    nfXY = [ nfXY; a1*ff1XYs(i,1) + b1*ff1XYs(i,2) + c1, d1*ff1XYs(i,1) + e1*ff1XYs(i,2) + f1];
end
disp(nfXY);
%New matrix for second floor found by using ax+by+c and dx+ey+f (multiplying A to
%transformation matrix).
nsXY = [];
for i=1:size(sf1XYs,1)
    nsXY = [ nsXY; a2*sf1XYs(i,1) + b2*sf1XYs(i,2) + c2, d2*sf1XYs(i,1) + e2*sf1XYs(i,2) + f2];
end
disp(nsXY);






% %Creating an image from the two A matrices with the new coordinates above.
% image = imread('first-floor.jpg');
% imshow(image);
% hold on
% plot(nfXY(:,1), nfXY(:,2), 'g*');



image = imread('second-floor.jpg');
imshow(image);
hold on
plot(nsXY(:,1), nsXY(:,2), 'b*');